<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live TV Player</title>
<style>
  body { background: #000; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin:0; }
  h2 { text-align: center; margin-bottom: 30px; }
  button { padding: 15px 25px; font-size: 18px; cursor: pointer; margin: 10px; }
  input { width: 90%; max-width: 600px; padding: 10px; font-size: 16px; margin-bottom: 20px; }
</style>
</head>
<body>

<h2 id="channelName">Loading...</h2>
<input type="text" id="streamURL" readonly />
<button id="copyBtn">Copy URL</button>
<button id="openBtn">Open in VLC / Network Player</button>

<script>
const urlParams = new URLSearchParams(window.location.search);
const channelId = urlParams.get('id');

async function fetchChannelData(id) {
    const res = await fetch(`/api/channel/${id}`);
    if (!res.ok) throw new Error("Channel not found");
    return await res.json();
}

async function initPlayer() {
    try {
        const ch = await fetchChannelData(channelId);
        document.getElementById('channelName').innerText = ch.name;
        const input = document.getElementById('streamURL');
        const copyBtn = document.getElementById('copyBtn');
        const openBtn = document.getElementById('openBtn');

        input.value = ch.link;

        copyBtn.onclick = () => {
            input.select();
            input.setSelectionRange(0, 99999);
            document.execCommand('copy');
            alert('✅ URL copied to clipboard!\n\nPaste it into VLC, MX Player, or any network stream app.');
        };

        openBtn.onclick = () => {
            alert(`⚠️ This stream must be opened in a network player app (VLC, MX Player, IPTV app).\n\nURL:\n${ch.link}`);
        };

    } catch (err) {
        document.body.innerHTML = `<p style="color:red; text-align:center;">Failed to load: ${err.message}</p>`;
        console.error(err);
    }
}

initPlayer();
</script>
</body>
</html>
